"use strict";var Terminator=function(){var t=function(t,e){this.config={alwaysFocus:!0,autoScroll:!0,prefix:"~$",caret:"_"};for(var i in e)e.hasOwnProperty(i)&&this.config.hasOwnProperty(i)&&(this.config[i]=e[i]);var n=document.createElement("input");n.setAttribute("type","text"),n.classList.add("terminator-hidden"),document.body.appendChild(n),this.element=t,this.hiddenField=n,this.displayField=null,this.activeCaret=null,this.callback=!1,this.locked=!1,n.addEventListener("input",function(){console.log("Typing!"),this.displayField&&!this.locked&&(window.scrollTo(0,document.body.scrollHeight),this.displayField.textContent=this.hiddenField.value)}.bind(this)),n.addEventListener("keydown",function(t){return 37==t.key||37==t.keyCode||39==t.key||39==t.keyCode?void t.preventDefault():void(13!=t.key&&13!=t.keyCode||this.locked||(console.log("Enter key pressed!"),window.scrollTo(0,document.body.scrollHeight),this.run(this.displayField.textContent)))}.bind(this)),this.config.alwaysFocus&&n.addEventListener("blur",function(){setTimeout(function(){var t=window.scrollX,e=window.scrollY;this.hiddenField.focus(),window.scrollTo(t,e)}.bind(this),0)}.bind(this),!0);var o={};this.register=function(t,e){if(Array.isArray(e))for(var i=0;i<e.length;i++)o[e[i]]=t;else o[e]=t},this.canExecute=function(t){return t&&o[t]},this.execute=function(t,e){return o[t](this,e)}};return t.prototype.writeLine=function(t){this.lineBreak();var e=document.createElement("span");return e.textContent=t,this.element.appendChild(e),e},t.prototype.writeHTML=function(t){this.lineBreak();var e=document.createElement("div");return e.innerHTML=t,this.element.appendChild(e),e},t.prototype.lineBreak=function(){var t=document.createElement("br");this.element.appendChild(t)},t.prototype.run=function(t){if(this.locked=!0,this.activeCaret.style.display="none",this.activeCaret=null,!t)return this.lineBreak(),void this.prompt();if(this.callback)return this.callback(this,t),this.callback=null,void(this.config.autoScroll&&window.scrollTo(0,document.body.scrollHeight));console.log("No callback for command: "+t);var e=t.split(" ");this.canExecute(e[0])?(console.log("Running registered program "+e[0]),this.execute(e[0],t),this.config.autoScroll&&window.scrollTo(0,document.body.scrollHeight)):(console.warn("Invalid command: "+t),this.writeLine(t+": command not found"),this.lineBreak(),this.prompt())},t.prototype.autoType=function(t,e){if(this.locked)console.warn("Terminal currently locked, cannot auto-type command: "+t);else{this.locked=!0,this.displayField.textContent="",e=e||0;for(var i=[],n=0;n<t.length;n++)i[n]=function(e){return function(){this.displayField.textContent+=t[e]}.bind(this)}.call(this,n);for(var o=0;o<t.length;o++)setTimeout(i[o],50*o+e);setTimeout(function(){this.run(this.displayField.textContent)}.bind(this),50*t.length+100+e)}},t.prototype.prompt=function(t,e){this.hiddenField.value="";var i=document.createElement("span");i.innerHTML=t||this.config.prefix;var n=document.createElement("span"),o=document.createElement("span");o.textContent=this.config.caret,o.classList.add("terminator-blink"),this.element.appendChild(i),this.element.appendChild(n),this.element.appendChild(o),this.displayField=n,this.activeCaret=o,this.callback=e||null,this.locked=!1,this.hiddenField.focus(),this.config.autoScroll&&window.scrollTo(0,document.body.scrollHeight)},t}();